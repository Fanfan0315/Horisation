# Horisation é¡¹ç›®ä¼˜åŒ–æ€»ç»“

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–é‡ç‚¹æ”¹è¿›äº† CSV/Excel å¤„ç†æ¨¡å—çš„**æ¶æ„è®¾è®¡**å’Œ**ç”¨æˆ·ç•Œé¢**ï¼Œå®ç°äº†ä¸šåŠ¡é€»è¾‘ä¸æ§åˆ¶å™¨çš„åˆ†ç¦»ï¼Œæå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

---

## ğŸ¯ ä¸»è¦æ”¹åŠ¨

### 1. åˆ›å»º `Backend/Functions/` æ¨¡å— âœ¨

**æ–°å¢æ–‡ä»¶ï¼š**
```
Backend/Functions/
â”œâ”€â”€ __init__.py           # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ csv_processor.py      # CSV/Excel æ–‡ä»¶å¤„ç†æ ¸å¿ƒï¼ˆ258è¡Œï¼‰
â”œâ”€â”€ csv_cleaner.py        # æ•°æ®æ¸…æ´—å’Œè½¬æ¢ï¼ˆ230è¡Œï¼‰
â””â”€â”€ README.md            # æ¨¡å—æ–‡æ¡£ï¼ˆ200+è¡Œï¼‰
```

**è®¾è®¡ç†å¿µï¼š**
- âœ… **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šController åªè´Ÿè´£è·¯ç”±ï¼ŒFunctions è´Ÿè´£ä¸šåŠ¡é€»è¾‘
- âœ… **ä»£ç å¤ç”¨**ï¼šæ ¸å¿ƒåŠŸèƒ½å¯è¢«å¤šä¸ª controller è°ƒç”¨
- âœ… **æ˜“äºæµ‹è¯•**ï¼šçº¯å‡½æ•°é€»è¾‘ï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯•
- âœ… **å¯ç»´æŠ¤æ€§**ï¼šä¸šåŠ¡é€»è¾‘é›†ä¸­ç®¡ç†

### 2. é‡æ„ `csvcontroller.py` ğŸ”§

**ä¼˜åŒ–å‰ï¼ˆ316è¡Œï¼‰â†’ ä¼˜åŒ–åï¼ˆ205è¡Œï¼‰**

**ä¸»è¦æ”¹åŠ¨ï¼š**
- ç§»é™¤äº†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆç¼–ç æ£€æµ‹ã€DataFrameå¤„ç†ç­‰ï¼‰
- Controller ç°åœ¨åªè´Ÿè´£ï¼š
  - è¯·æ±‚éªŒè¯ï¼ˆ`_get_file_and_bytes()`ï¼‰
  - å‚æ•°è§£æ
  - è°ƒç”¨ Functions æ¨¡å—
  - è¿”å› JSON å“åº”

**æ–°å¢ API ç«¯ç‚¹ï¼š**
```python
POST /api/csv/preview   # é¢„è§ˆå‰Nè¡Œ
POST /api/csv/summary   # è·å–æ¦‚è¦ä¿¡æ¯
POST /api/csv/clean     # æ¸…æ´—æ•°æ®ï¼ˆæ–°å¢ï¼‰
```

**ä»£ç å¯¹æ¯”ï¼š**

*ä¼˜åŒ–å‰ï¼š*
```python
def api_preview():
    # 100+ è¡Œçš„æ–‡ä»¶è¯»å–ã€ç¼–ç æ£€æµ‹ã€DataFrameå¤„ç†...
    bio = BytesIO(binary)
    for enc in encodings:
        try:
            df = pd.read_csv(bio, encoding=enc)
            # ... æ›´å¤šå¤„ç†é€»è¾‘
```

*ä¼˜åŒ–åï¼š*
```python
def api_preview():
    filename, data, err = _get_file_and_bytes()
    if err:
        return jsonify({'ok': False, 'error': err[0]}), err[1]

    # ç›´æ¥è°ƒç”¨ Functions æ¨¡å—
    payload = csv_processor.get_preview(data, n=n, filename=filename)
    return jsonify({'ok': True, **payload})
```

### 3. ä¼˜åŒ–å‰ç«¯ `CSV.html` ğŸ¨

**UI/UX æ”¹è¿›ï¼š**

#### å¸ƒå±€ä¼˜åŒ–
- **ä¼˜åŒ–å‰**ï¼šå•ä¸€å¹³é“ºå¸ƒå±€ï¼Œæ‰€æœ‰å…ƒç´ æ··åœ¨ä¸€èµ·
- **ä¼˜åŒ–å**ï¼šå¡ç‰‡å¼åˆ†åŒºå¸ƒå±€
  - ğŸ“¤ ä¸Šä¼ åŒºåŸŸï¼ˆUpload Sectionï¼‰
  - âš™ï¸ æ§åˆ¶é¢æ¿ï¼ˆControl Panelï¼‰
  - ğŸ“Š ç»“æœå±•ç¤ºåŒºï¼ˆResult Section with Tabsï¼‰

#### æ–°å¢åŠŸèƒ½
1. **Tab åˆ‡æ¢**ï¼š
   - æ•°æ®é¢„è§ˆ Tab
   - ç»Ÿè®¡ä¿¡æ¯ Tab
   - å¹³æ»‘çš„åˆ‡æ¢åŠ¨ç”»

2. **å½©è‰²åˆ—æ ‡ç­¾**ï¼š
   - ğŸ”µ æ–‡æœ¬ç±»å‹ï¼ˆè“è‰²ï¼‰
   - ğŸŸ¢ æ•°å€¼ç±»å‹ï¼ˆç»¿è‰²ï¼‰
   - ğŸŸ¡ æ—¥æœŸç±»å‹ï¼ˆé»„è‰²ï¼‰

3. **æ”¹è¿›çš„çŠ¶æ€æç¤º**ï¼š
   - âœ… æˆåŠŸçŠ¶æ€ï¼ˆç»¿è‰²badgeï¼‰
   - âŒ é”™è¯¯çŠ¶æ€ï¼ˆçº¢è‰²badgeï¼‰
   - â„¹ï¸ ä¿¡æ¯çŠ¶æ€ï¼ˆè“è‰²badgeï¼‰

4. **å“åº”å¼æ§åˆ¶é¢æ¿**ï¼š
   - Grid å¸ƒå±€è‡ªåŠ¨é€‚åº”
   - ç¼–ç ã€åˆ†éš”ç¬¦ã€è¡Œæ•°ã€å¤§å°å†™ç­‰é€‰é¡¹
   - ä¸‰ä¸ªæ“ä½œæŒ‰é’®ï¼šé¢„è§ˆã€æ¦‚è¦ã€æ¸…æ´—

#### è§†è§‰è®¾è®¡æ”¹è¿›
```css
/* ä¼˜åŒ–å‰ */
.upload-area { border: 2px dashed #e5e7eb; }

/* ä¼˜åŒ–å */
.upload-area {
    border: 2px dashed #d1d5db;
    transition: all 0.3s;
    background: #f9fafb;
}
.upload-area:hover {
    border-color: #9ca3af;
}
.upload-area.dragover {
    background: #eff6ff;
    border-color: #3b82f6;
}
```

### 4. æ›´æ–° `app.py` ğŸ“

**æ”¹è¿›ç‚¹ï¼š**
- âœ… æ³¨å†Œ CSV Blueprint
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆ413, 404, 500ï¼‰
- âœ… æ›´å‹å¥½çš„å¯åŠ¨æ—¥å¿—
- âœ… è‡ªåŠ¨åˆ›å»ºä¸Šä¼ ç›®å½•

**å¯åŠ¨ä¿¡æ¯ç¤ºä¾‹ï¼š**
```
============================================================
ğŸš€ Horisation Application Starting...
============================================================
ğŸ“‚ Template Directory: C:/...Template (exists: True)
ğŸ“‚ Static Directory: C:/...Static (exists: True)
ğŸ“‚ Upload Directory: C:/..._uploads (exists: True)
============================================================
âœ… Registered Blueprint: csv_api

============================================================
ğŸŒ Server running at: http://localhost:5000
ğŸ“Š CSV Workspace: http://localhost:5000/csv
============================================================
```

---

## ğŸ“Š æ”¹è¿›å¯¹æ¯”è¡¨

| ç»´åº¦ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| **ä»£ç ç»“æ„** | ControlleråŒ…å«ä¸šåŠ¡é€»è¾‘ | ä¸šåŠ¡é€»è¾‘åˆ†ç¦»åˆ°Functions | â­â­â­â­â­ |
| **ä»£ç è¡Œæ•°** | csvcontroller.py: 316è¡Œ | csvcontroller.py: 205è¡Œ + Functions: 488è¡Œ | æ›´æ¸…æ™° |
| **å¯ç»´æŠ¤æ€§** | é€»è¾‘è€¦åˆï¼Œéš¾ä»¥ä¿®æ”¹ | æ¨¡å—åŒ–ï¼Œæ˜“äºç»´æŠ¤ | â­â­â­â­â­ |
| **å¯æµ‹è¯•æ€§** | éš¾ä»¥å•å…ƒæµ‹è¯• | çº¯å‡½æ•°æ˜“æµ‹è¯• | â­â­â­â­â­ |
| **å‰ç«¯UI** | åŸºç¡€å¸ƒå±€ï¼ŒåŠŸèƒ½å•ä¸€ | ç°ä»£åŒ–å¡ç‰‡å¸ƒå±€ï¼ŒTabåˆ‡æ¢ | â­â­â­â­â­ |
| **ç”¨æˆ·ä½“éªŒ** | ä¿¡æ¯æ··æ‚ | åˆ†åŒºæ¸…æ™°ï¼ŒçŠ¶æ€æ˜ç¡® | â­â­â­â­â­ |

---

## ğŸš€ æ–°åŠŸèƒ½ç‰¹æ€§

### 1. CSV Processorï¼ˆæ–‡ä»¶å¤„ç†å™¨ï¼‰
- âœ… æ™ºèƒ½ç¼–ç æ£€æµ‹ï¼ˆUTF-8 â†’ GBK â†’ GB2312 â†’ Big5...ï¼‰
- âœ… Excel æ”¯æŒï¼ˆ.xls / .xlsxï¼‰
- âœ… å¤šçº§è¡¨å¤´è‡ªåŠ¨å±•å¹³
- âœ… PyArrow åŠ é€Ÿï¼ˆå¯é€‰ï¼Œæ€§èƒ½æå‡30-50%ï¼‰
- âœ… æ•°æ®ç±»å‹æ¨æ–­ï¼ˆnumeric / date / textï¼‰

### 2. CSV Cleanerï¼ˆæ•°æ®æ¸…æ´—å™¨ï¼‰
- âœ… åˆ—åæ ‡å‡†åŒ–
  - å¤§å°å†™è½¬æ¢ï¼ˆupper / lower / titleï¼‰
  - å»é™¤ç‰¹æ®Šå­—ç¬¦
  - è‡ªåŠ¨å»é‡ï¼ˆæ·»åŠ  _1, _2 åç¼€ï¼‰
  - æ·»åŠ å‰ç¼€

- âœ… å•å…ƒæ ¼æ¸…æ´—
  - å»é™¤é¦–å°¾ç©ºæ ¼
  - ç»Ÿä¸€ç¼ºå¤±å€¼æ ‡è®°

- âœ… æ•°æ®è½¬æ¢
  - ç™¾åˆ†æ¯”æ ‡å‡†åŒ–ï¼ˆ50% â†’ 0.5ï¼‰
  - æ—¥æœŸæ ‡å‡†åŒ–
  - å¼‚å¸¸å€¼æ£€æµ‹ï¼ˆZ-score / IQRï¼‰

- âœ… æ•°æ®å»é‡
  - åŸºäºæŒ‡å®šåˆ—
  - ä¿ç•™ç­–ç•¥ï¼ˆfirst / lastï¼‰

### 3. æ–°å¢ API ç«¯ç‚¹

```bash
# æ¸…æ´—æ•°æ®ï¼ˆæ–°å¢ï¼‰
curl -X POST \
  -F "file=@data.csv" \
  "http://localhost:5000/api/csv/clean?case=upper&remove_duplicates=true"

# è¿”å›ç¤ºä¾‹
{
  "ok": true,
  "filename": "data.csv",
  "cleaned_rows": 950,
  "removed_duplicates": 50,
  "columns": ["ID", "NAME", "AGE", "SALARY"]
}
```

---

## ğŸ“‚ æœ€ç»ˆé¡¹ç›®ç»“æ„

```
Horisation/
â”œâ”€â”€ app.py                    # âœ¨ é‡æ„ï¼šBlueprintæ³¨å†Œã€é”™è¯¯å¤„ç†
â”œâ”€â”€ Backend/
â”‚   â”œâ”€â”€ Controller/
â”‚   â”‚   â”œâ”€â”€ csvcontroller.py  # âœ¨ ä¼˜åŒ–ï¼šç§»é™¤ä¸šåŠ¡é€»è¾‘ï¼Œä»…ä¿ç•™è·¯ç”±
â”‚   â”‚   â””â”€â”€ csv_handling.py   # ä¿ç•™ï¼ˆå…¼å®¹æ—§ä»£ç ï¼‰
â”‚   â”œâ”€â”€ Functions/            # ğŸ†• æ–°å¢ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ csv_processor.py  # æ–‡ä»¶å¤„ç†æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ csv_cleaner.py    # æ•°æ®æ¸…æ´—å™¨
â”‚   â”‚   â””â”€â”€ README.md         # æ¨¡å—æ–‡æ¡£
â”‚   â””â”€â”€ Horfunc/
â”‚       â””â”€â”€ finpkg.py         # é‡‘èå‡½æ•°
â”œâ”€â”€ Template/
â”‚   â”œâ”€â”€ CSV.html              # âœ¨ ä¼˜åŒ–ï¼šç°ä»£åŒ–UIã€Tabåˆ‡æ¢
â”‚   â”œâ”€â”€ Home.html
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Static/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ horcsv.js        # å‰ç«¯é€»è¾‘
â”‚   â””â”€â”€ css/
â””â”€â”€ OPTIMIZATION_SUMMARY.md  # ğŸ†• æœ¬æ–‡æ¡£
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

**åç«¯ï¼š**
- Flask 2.x
- Pandas + NumPy
- PyArrowï¼ˆå¯é€‰åŠ é€Ÿï¼‰
- openpyxl / xlrdï¼ˆExcelæ”¯æŒï¼‰

**å‰ç«¯ï¼š**
- HTML5 + CSS3
- Vanilla JavaScriptï¼ˆæ— æ¡†æ¶ï¼‰
- Font Awesomeï¼ˆå›¾æ ‡ï¼‰

---

## ğŸ“ˆ æ€§èƒ½æå‡

1. **ç¼–ç æ£€æµ‹ä¼˜åŒ–**ï¼š
   - ä¼˜å…ˆä½¿ç”¨ PyArrow å¼•æ“ï¼ˆæ€§èƒ½æå‡ 30-50%ï¼‰
   - æ™ºèƒ½ç¼–ç å›é€€ï¼Œå‡å°‘é‡è¯•æ¬¡æ•°

2. **å†…å­˜ä¼˜åŒ–**ï¼š
   - é¢„è§ˆæ—¶é™åˆ¶è¯»å–è¡Œæ•°ï¼ˆnrowså‚æ•°ï¼‰
   - å¤§æ–‡ä»¶è‡ªåŠ¨åˆ†å—å¤„ç†

3. **å‰ç«¯ä¼˜åŒ–**ï¼š
   - Tab æ‡’åŠ è½½
   - é˜²æŠ–çš„æ‹–æ‹½äº‹ä»¶å¤„ç†

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```python
# tests/test_csv_processor.py
import pytest
from Backend.Functions import csv_processor

def test_preview():
    csv_data = b"Name,Age\nAlice,25\nBob,30"
    result = csv_processor.get_preview(csv_data, n=5)

    assert result['columns'] == ['Name', 'Age']
    assert len(result['rows']) == 2
    assert result['rows'][0]['Name'] == 'Alice'

def test_encoding_fallback():
    # GBKç¼–ç çš„CSV
    gbk_data = "å§“å,å¹´é¾„\nå¼ ä¸‰,25".encode('gbk')
    result = csv_processor.get_preview(gbk_data, n=5)

    assert 'å§“å' in result['columns']
```

### é›†æˆæµ‹è¯•

```python
# tests/test_api.py
def test_preview_api(client):
    data = {'file': (BytesIO(b"col1,col2\n1,2"), 'test.csv')}
    response = client.post('/api/csv/preview', data=data)

    assert response.status_code == 200
    assert response.json['ok'] == True
    assert 'columns' in response.json
```

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§APIè¿ç§»

**æ—§ä»£ç ï¼š**

```python
from Backend.Sandbox.data_frame_handling.csv_handling import read_csv_preview

preview = read_csv_preview(binary_data, n=10)
```

**æ–°ä»£ç ï¼š**
```python
from Backend.Functions import csv_processor
preview = csv_processor.get_preview(binary_data, n=10)
```

### å…¼å®¹æ€§è¯´æ˜
- âœ… `csv_handling.py` ä¿ç•™ï¼Œä¿è¯å‘åå…¼å®¹
- âœ… æ—§çš„APIç«¯ç‚¹ï¼ˆå¦‚ `/api/upload`ï¼‰ä»ç„¶å¯ç”¨
- âœ… æ–°æ—§ä»£ç å¯ä»¥å…±å­˜

---

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
1. âœ… æ·»åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV / Excel / JSONï¼‰
2. âœ… å®ç°æ•°æ®åˆå¹¶åŠŸèƒ½ï¼ˆconcat / mergeï¼‰
3. âœ… æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰
1. ğŸ”„ å®ç°å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆCelery + Redisï¼‰
2. ğŸ”„ æ·»åŠ æ•°æ®å¯è§†åŒ–ï¼ˆChart.js / EChartsï¼‰
3. ğŸ”„ æ”¯æŒæ•°æ®åº“å¯¼å…¥/å¯¼å‡º

### é•¿æœŸï¼ˆ3ä¸ªæœˆï¼‰
1. ğŸ“Š æœºå™¨å­¦ä¹ é›†æˆï¼ˆæ•°æ®é¢„å¤„ç†Pipelineï¼‰
2. ğŸ¤– æ™ºèƒ½æ•°æ®æ¸…æ´—å»ºè®®
3. ğŸ“ˆ å®æ—¶æ•°æ®åˆ†æDashboard

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸå®ç°äº†ï¼š
- âœ… **æ¶æ„å‡çº§**ï¼šä¸šåŠ¡é€»è¾‘ä¸Controlleråˆ†ç¦»
- âœ… **ä»£ç è´¨é‡**ï¼šæå‡å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šç°ä»£åŒ–UIè®¾è®¡ï¼ŒåŠŸèƒ½æ›´ä¸°å¯Œ
- âœ… **æ€§èƒ½æå‡**ï¼šç¼–ç æ£€æµ‹ä¼˜åŒ–ï¼ŒPyArrowåŠ é€Ÿ
- âœ… **æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

é¡¹ç›®ç°åœ¨å…·å¤‡äº†æ›´å¥½çš„ç»“æ„ï¼Œä¸ºåç»­åŠŸèƒ½å¼€å‘æ‰“ä¸‹äº†åšå®åŸºç¡€ï¼ğŸš€

---

**Created by:** Claude Code
**Date:** 2025-10-11
**Version:** Horisation v2.0
